

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>annotationframeworkclient.chunkedgraph &mdash; CAVEclient 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> CAVEclient
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/intro.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/framework.html">CAVEclient: One client for all services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/authentication.html">Authentication Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/annotation.html">AnnotationEngine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/chunkedgraph.html">ChunkedGraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/info.html">Info Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/schemas.html">EMAnnotationSchemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/state.html">JSON Neuroglancer State Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/materialization.html">Materialization</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/caveclient.html">caveclient package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CAVEclient</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>annotationframeworkclient.chunkedgraph</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for annotationframeworkclient.chunkedgraph</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">endpoints</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">infoservice</span>
<span class="kn">from</span> <span class="nn">.endpoints</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">chunkedgraph_api_versions</span><span class="p">,</span>
    <span class="n">chunkedgraph_endpoints_common</span><span class="p">,</span>
    <span class="n">default_global_server_address</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_api_endpoints</span><span class="p">,</span> <span class="n">_api_versions</span><span class="p">,</span> <span class="n">ClientBase</span><span class="p">,</span> <span class="n">handle_response</span>
<span class="kn">from</span> <span class="nn">.auth</span> <span class="kn">import</span> <span class="n">AuthClient</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>


<span class="n">SERVER_KEY</span> <span class="o">=</span> <span class="s2">&quot;cg_server_address&quot;</span>


<div class="viewcode-block" id="CGEncoder"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.CGEncoder">[docs]</a><span class="k">class</span> <span class="nc">CGEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<div class="viewcode-block" id="CGEncoder.default"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.CGEncoder.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="package_bounds"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.package_bounds">[docs]</a><span class="k">def</span> <span class="nf">package_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Bounds must be a 3x2 matrix (x,y,z) x (min,max) in chunkedgraph resolution voxel units&quot;</span>
        <span class="p">)</span>

    <span class="n">bounds_str</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">:</span>
        <span class="n">bounds_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b2</span> <span class="ow">in</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">bounds_str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bounds_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bounds_str</span></div>


<div class="viewcode-block" id="package_timestamp"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.package_timestamp">[docs]</a><span class="k">def</span> <span class="nf">package_timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())}</span>
    <span class="k">return</span> <span class="n">query_d</span></div>


<div class="viewcode-block" id="ChunkedGraphClient"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClient">[docs]</a><span class="k">def</span> <span class="nf">ChunkedGraphClient</span><span class="p">(</span>
    <span class="n">server_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">auth_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span><span class="p">,</span>
    <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">server_address</span> <span class="o">=</span> <span class="n">default_global_server_address</span>

    <span class="k">if</span> <span class="n">auth_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auth_client</span> <span class="o">=</span> <span class="n">AuthClient</span><span class="p">()</span>

    <span class="n">auth_header</span> <span class="o">=</span> <span class="n">auth_client</span><span class="o">.</span><span class="n">request_header</span>

    <span class="n">endpoints</span><span class="p">,</span> <span class="n">api_version</span> <span class="o">=</span> <span class="n">_api_endpoints</span><span class="p">(</span>
        <span class="n">api_version</span><span class="p">,</span>
        <span class="n">SERVER_KEY</span><span class="p">,</span>
        <span class="n">server_address</span><span class="p">,</span>
        <span class="n">chunkedgraph_endpoints_common</span><span class="p">,</span>
        <span class="n">chunkedgraph_api_versions</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ChunkedClient</span> <span class="o">=</span> <span class="n">client_mapping</span><span class="p">[</span><span class="n">api_version</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ChunkedClient</span><span class="p">(</span>
        <span class="n">server_address</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="p">,</span>
        <span class="n">api_version</span><span class="p">,</span>
        <span class="n">endpoints</span><span class="p">,</span>
        <span class="n">SERVER_KEY</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="ChunkedGraphClientV1"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1">[docs]</a><span class="k">class</span> <span class="nc">ChunkedGraphClientV1</span><span class="p">(</span><span class="n">ClientBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ChunkedGraph Client for the v1 API&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">server_address</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="p">,</span>
        <span class="n">api_version</span><span class="p">,</span>
        <span class="n">endpoints</span><span class="p">,</span>
        <span class="n">server_key</span><span class="o">=</span><span class="n">SERVER_KEY</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ChunkedGraphClientV1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">server_address</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">server_key</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_url_mapping</span><span class="p">[</span><span class="s2">&quot;table_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_url_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_url_mapping</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span>

    <span class="k">def</span> <span class="nf">_process_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process timestamp with default logic&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">timestamp</span>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_roots"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_roots">[docs]</a>    <span class="k">def</span> <span class="nf">get_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supervoxel_ids</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_layer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the root id for a specified supervoxel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        supervoxel_ids : np.array(np.uint64)</span>
<span class="sd">            Supervoxel ids values</span>
<span class="sd">        timestamp : datetime.datetime, optional</span>
<span class="sd">            UTC datetime to specify the state of the chunkedgraph at which to query, by default None. If None, uses the current time.</span>
<span class="sd">        stop_layer : int or None, optional</span>
<span class="sd">            If True, looks up ids only up to a given stop layer. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.array(np.uint64)</span>
<span class="sd">            Root IDs containing each supervoxel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;get_roots&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="n">package_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">stop_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s1">&#39;stop_layer&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">stop_layer</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">supervoxel_ids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_root_id"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_root_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_root_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supervoxel_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level2</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the root id for a specified supervoxel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        supervoxel_id : np.uint64</span>
<span class="sd">            Supervoxel id value</span>
<span class="sd">        timestamp : datetime.datetime, optional</span>
<span class="sd">            UTC datetime to specify the state of the chunkedgraph at which to query, by default None. If None, uses the current time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.uint64</span>
<span class="sd">            Root ID containing the supervoxel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;supervoxel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">supervoxel_id</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;handle_root&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="n">package_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">level2</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;stop_layer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;root_id&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_merge_log"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_merge_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_merge_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the merge log (splits and merges) for an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Object root id to look up</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of merge events in the history of the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;merge_log&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_change_log"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_change_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_change_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">filtered</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the change log (splits and merges) for an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Object root id to look up</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of split and merge events in the object history</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;change_log&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filtered&quot;</span><span class="p">:</span> <span class="n">filtered</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_leaves"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_leaves">[docs]</a>    <span class="k">def</span> <span class="nf">get_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_layer</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all supervoxels for a root_id</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Root id to query</span>
<span class="sd">        bounds: np.array or None, optional</span>
<span class="sd">            If specified, returns supervoxels within a 3x2 numpy array of bounds [[minx,maxx],[miny,maxy],[minz,maxz]]</span>
<span class="sd">            If None, finds all supervoxels.</span>
<span class="sd">        stop_layer: int, optional</span>
<span class="sd">            If specified, returns chunkedgraph nodes at layer =stop_layer</span>
<span class="sd">            default will be stop_layer=1 (supervoxels)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of supervoxel ids (or nodeids if stop_layer&gt;1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;leaves_from_root&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stop_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;stop_layer&quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop_layer</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)[</span><span class="s2">&quot;leaf_ids&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.do_merge"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.do_merge">[docs]</a>    <span class="k">def</span> <span class="nf">do_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supervoxels</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">40</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Perform a merge on the chunkeded graph</span>

<span class="sd">        Args:</span>
<span class="sd">            supervoxels (iterable): a N long list of supervoxels to merge</span>
<span class="sd">            coords (np.array): a Nx3 array of coordinates of the supervoxels in units of resolution</span>
<span class="sd">            resolution (tuple, optional): what to multiple the coords by to get nm. Defaults to (4,4,40).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;do_merge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">svid</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">supervoxels</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">svid</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor</span><span class="p">)</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">])</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CGEncoder</span><span class="p">),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_children"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the children of a node in the hierarchy</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_id : np.uint64</span>
<span class="sd">            Node id to query</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of np.uint64 ids of child nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;handle_children&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)[</span><span class="s1">&#39;children_ids&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_contact_sites"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_contact_sites">[docs]</a>    <span class="k">def</span> <span class="nf">get_contact_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">calc_partners</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get contacts for a root id</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Object root id</span>
<span class="sd">        bounds: np.array</span>
<span class="sd">            Bounds within a 3x2 numpy array of bounds [[minx,maxx],[miny,maxy],[minz,maxz]] for which to find contacts. Running this query without bounds is too slow.</span>
<span class="sd">        calc_partners : bool, optional</span>
<span class="sd">            If True, get partner root ids. By default, False.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dict relating ids to contacts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;contact_sites&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;partners&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_partners</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">[</span><span class="n">root_id</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="n">contact_d</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">contact_d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.find_path"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.find_path">[docs]</a>    <span class="k">def</span> <span class="nf">find_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">src_pt</span><span class="p">,</span> <span class="n">dst_pt</span><span class="p">,</span> <span class="n">precision_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;find a path between two locations on a root_id using the supervoxel lvl2 graph.</span>

<span class="sd">        Args:</span>
<span class="sd">            root_id (np.int64): the root id to search on</span>
<span class="sd">            src_pt (np.array): len(3) xyz location of the start location in nm</span>
<span class="sd">            dst_pt ([type]): len(3) xyz location of the end location in nm</span>
<span class="sd">            precision_mode (bool, optional): Whether to perform the search in precision mode. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            centroids_list: centroids</span>
<span class="sd">            l2_path: l2_path</span>
<span class="sd">            failed_l2_ids: failed_l2_ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;find_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;precision_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_mode</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[[</span><span class="n">root_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">src_pt</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="n">root_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">dst_pt</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CGEncoder</span><span class="p">),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">resp_d</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resp_d</span><span class="p">[</span><span class="s2">&quot;centroids_list&quot;</span><span class="p">])</span>
        <span class="n">failed_l2_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resp_d</span><span class="p">[</span><span class="s2">&quot;failed_l2_ids&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
        <span class="n">l2_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resp_d</span><span class="p">[</span><span class="s2">&quot;l2_path&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">l2_path</span><span class="p">,</span> <span class="n">failed_l2_ids</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_subgraph"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_subgraph">[docs]</a>    <span class="k">def</span> <span class="nf">get_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">bounds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get subgraph of root id within a bounding box</span>

<span class="sd">        Args:</span>
<span class="sd">            root_id ([int64]): root (or seg_id/node_id) of chunkedgraph to query</span>
<span class="sd">            bounds ([np.array]): 3x2 bounding box (x,y,z)x (min,max) in chunkedgraph coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;get_subgraph&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;affinities&quot;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;areas&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.level2_chunk_graph"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.level2_chunk_graph">[docs]</a>    <span class="k">def</span> <span class="nf">level2_chunk_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get graph of level 2 chunks, the smallest agglomeration level above supervoxels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : int</span>
<span class="sd">            Root id of object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        edge_list : list</span>
<span class="sd">            Edge array of level 2 ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;lvl2_graph&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;edge_graph&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.remesh_level2_chunks"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.remesh_level2_chunks">[docs]</a>    <span class="k">def</span> <span class="nf">remesh_level2_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit specific level 2 chunks to be remeshed in case of a problem.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        chunk_ids : list</span>
<span class="sd">            List of level 2 chunk ids.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;remesh_level2_chunks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;new_lvl2_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">chunk_ids</span><span class="p">]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ChunkedGraphClientV1.get_operation_details"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_operation_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_operation_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation_ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;get the details of a list of operations</span>

<span class="sd">        Args:</span>
<span class="sd">            operation_ids (Iterable[int]): list of operation IDss</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: a dict of dictss of operation info, keys are operationids</span>
<span class="sd">            values are a dictionary of operation info for the operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation_ids</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">operation_ids</span> <span class="o">=</span> <span class="n">operation_ids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s1">&#39;operation_details&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span>
            <span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;operation_ids&#39;</span><span class="p">:</span><span class="n">operation_ids</span><span class="p">}</span>
        <span class="n">query_str</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_d</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">query_str</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>
<div class="viewcode-block" id="ChunkedGraphClientV1.get_lineage_graph"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_lineage_graph">[docs]</a>    <span class="k">def</span> <span class="nf">get_lineage_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">timestamp_past</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestamp_future</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the lineage graph for a root id, optionally cut off in the past or the future.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : int</span>
<span class="sd">            Object root id</span>
<span class="sd">        timestamp_past : datetime.datetime or None, optional</span>
<span class="sd">            Cutoff for the lineage graph backwards in time. By default, None.</span>
<span class="sd">        timestamp_future : datetime.datetime or None, optional</span>
<span class="sd">            Cutoff for the lineage graph going forwards in time. By default, None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary describing the lineage graph and operations for the root id.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">timestamp_past</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp_past&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp_past</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">timestamp_future</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp_future&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp_future</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;handle_lineage_graph&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span></div>
    
<div class="viewcode-block" id="ChunkedGraphClientV1.is_latest_roots"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.is_latest_roots">[docs]</a>    <span class="k">def</span> <span class="nf">is_latest_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_ids</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;check whether these root_ids are still a root at this timestamp</span>

<span class="sd">            Args:</span>
<span class="sd">                root_ids ([type]): root ids to check</span>
<span class="sd">                timestamp (datetime.dateime, optional): timestamp to check whether these IDs are valid root_ids. Defaults to None (assumes now).</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                np.array[np.Boolean]: boolean array of whether these are valid root_ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;is_latest_roots&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query_d</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;node_ids&quot;</span><span class="p">:</span> <span class="n">root_ids</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> 
                                             <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CGEncoder</span><span class="p">),</span>
                                             <span class="n">params</span> <span class="o">=</span> <span class="n">query_d</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;is_latest&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span></div>



<div class="viewcode-block" id="ChunkedGraphClientV1.get_past_ids"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientV1.get_past_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_past_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_ids</span><span class="p">,</span> <span class="n">timestamp_past</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestamp_future</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a set of root ids, get the list of ids at a past or future time point that could contain parts of the same object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_ids: Iterable,</span>
<span class="sd">            Iterable of seed root ids.</span>
<span class="sd">        timestamp_past : datetime.datetime or None, optional</span>
<span class="sd">            Time of a point in the past for which to look up root ids. Default is None.</span>
<span class="sd">        timestamp_future : datetime.datetime or None, optional</span>
<span class="sd">            Time of a point in the future for which to look up root ids. Not implemented on the server currently. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dict with keys `future_id_map` and `past_id_map`. Each is a dict whose keys are the supplied root ids and whose values</span>
<span class="sd">            are the list of related root ids at the past/future time stamp.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">timestamp_past</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;timestamp_past&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp_past</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">timestamp_future</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;timestamp_future&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp_future</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;root_ids&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">root_ids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;past_id_mapping&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CGEncoder</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Convert id keys as strings to ints</span>
        <span class="n">past_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;past_id_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">past_keys</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;past_id_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">r</span><span class="p">[</span><span class="s2">&quot;past_id_map&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dat</span>

        <span class="n">fut_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;future_id_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fut_keys</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;future_id_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">r</span><span class="p">[</span><span class="s2">&quot;future_id_map&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dat</span>
        <span class="k">return</span> <span class="n">r</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cloudvolume_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;cloudvolume_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">segmentation_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Complete segmentation metadata&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_info</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MIP 0 resolution for voxels assumed by the ChunkedGraph</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            3-long list of x/y/z voxel dimensions in nm</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_info</span><span class="p">[</span><span class="s2">&quot;scales&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resolution&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChunkedGraphClientLegacy"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy">[docs]</a><span class="k">class</span> <span class="nc">ChunkedGraphClientLegacy</span><span class="p">(</span><span class="n">ClientBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Client to interface with the PyChunkedGraph service</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    server_address : str or None, optional</span>
<span class="sd">        URL where the PyChunkedGraph service is running. If None, defaults to www.dynamicannotationframework.com</span>
<span class="sd">    table_name : str or None, optional</span>
<span class="sd">        Name of the chunkedgraph table associated with the dataset. If the datastack_name is specified and table name is not, this can be looked up automatically. By default, None.</span>
<span class="sd">    auth_client : auth.AuthClient or None, optional</span>
<span class="sd">        Instance of an AuthClient with token to handle authorization. If None, does not specify a token.</span>
<span class="sd">    timestamp : datetime.datetime or None, optional</span>
<span class="sd">        Default UTC timestamp to use for chunkedgraph queries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">server_address</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="p">,</span>
        <span class="n">api_version</span><span class="p">,</span>
        <span class="n">endpoints</span><span class="p">,</span>
        <span class="n">server_key</span><span class="o">=</span><span class="n">SERVER_KEY</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ChunkedGraphClientLegacy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">server_address</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span> <span class="n">server_key</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_url_mapping</span><span class="p">[</span><span class="s2">&quot;table_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span> <span class="o">=</span> <span class="n">table_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_url_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_url_mapping</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_roots"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_roots">[docs]</a>    <span class="k">def</span> <span class="nf">get_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supervoxel_ids</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the root id for a specified supervoxel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        supervoxel_ids : np.array(np.uint64)</span>
<span class="sd">            Supervoxel ids values</span>
<span class="sd">        timestamp : datetime.datetime, optional</span>
<span class="sd">            UTC datetime to specify the state of the chunkedgraph at which to query, by default None. If None, uses the current time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.array(np.uint64)</span>
<span class="sd">            Root IDs containing each supervoxel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;get_roots&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query_d</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">supervoxel_ids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_root_id"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_root_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_root_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supervoxel_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level2</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the root id for a specified supervoxel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        supervoxel_id : np.uint64</span>
<span class="sd">            Supervoxel id value</span>
<span class="sd">        timestamp : datetime.datetime, optional</span>
<span class="sd">            UTC datetime to specify the state of the chunkedgraph at which to query, by default None. If None, uses the current time.</span>
<span class="sd">        level2 : bool, optional</span>
<span class="sd">            Return true to get the level 2 id of a supervoxel.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.uint64</span>
<span class="sd">            Root ID containing the supervoxel (or level 2 id if requested)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;supervoxel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">supervoxel_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;handle_root&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_timestamp</span>

        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">level2</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;stop_layer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)[</span><span class="s2">&quot;root_id&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_merge_log"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_merge_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_merge_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the merge log for a given object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Root id of an object to get merge information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of merge events in the history of the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;merge_log&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">[</span><span class="n">root_id</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_change_log"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_change_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_change_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the change log (splits and merges) for an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Object root id to look up</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of split and merge events in the object history</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;change_log&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">[</span><span class="n">root_id</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_leaves"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_leaves">[docs]</a>    <span class="k">def</span> <span class="nf">get_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_layer</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all supervoxels for a root_id</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Root id to query</span>
<span class="sd">        bounds: np.array or None, optional</span>
<span class="sd">            If specified, returns supervoxels within a 3x2 numpy array of bounds [[minx,maxx],[miny,maxy],[minz,maxz]]</span>
<span class="sd">            If None, finds all supervoxels.</span>
<span class="sd">        stop_layer: int, optional</span>
<span class="sd">            If specified, returns chunkedgraph nodes at layer =stop_layer</span>
<span class="sd">            default will be stop_layer=1 (supervoxels)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of supervoxel ids (or nodeids if stop_layer&gt;1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;leaves_from_root&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stop_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;stop_layer&quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop_layer</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)[</span><span class="s2">&quot;leaf_ids&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.do_merge"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.do_merge">[docs]</a>    <span class="k">def</span> <span class="nf">do_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supervoxels</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">40</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Perform a merge on the chunkeded graph</span>

<span class="sd">        Args:</span>
<span class="sd">            supervoxels (iterable): a N long list of supervoxels to merge</span>
<span class="sd">            coords (np.array): a Nx3 array of coordinates of the supervoxels in units of resolution</span>
<span class="sd">            resolution (tuple, optional): what to multiple the coords by to get nm. Defaults to (4,4,40).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;do_merge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">svid</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">supervoxels</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">svid</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor</span><span class="p">)</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">])</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CGEncoder</span><span class="p">),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_children"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the children of a node in the hierarchy</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_id : np.uint64</span>
<span class="sd">            Node id to query</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of np.uint64 ids of child nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;handle_children&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.get_contact_sites"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.get_contact_sites">[docs]</a>    <span class="k">def</span> <span class="nf">get_contact_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">calc_partners</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get contacts for a root id</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root_id : np.uint64</span>
<span class="sd">            Object root id</span>
<span class="sd">        bounds: np.array</span>
<span class="sd">            Bounds within a 3x2 numpy array of bounds [[minx,maxx],[miny,maxy],[minz,maxz]] for which to find contacts. Running this query without bounds is too slow.</span>
<span class="sd">        calc_partners : bool, optional</span>
<span class="sd">            If True, get partner root ids. By default, False.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dict relating ids to contacts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;contact_sites&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;partners&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_partners</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">[</span><span class="n">root_id</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">)</span>
        <span class="n">contact_d</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">contact_d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>

<div class="viewcode-block" id="ChunkedGraphClientLegacy.find_path"><a class="viewcode-back" href="../../api/annotationframeworkclient.html#annotationframeworkclient.chunkedgraph.ChunkedGraphClientLegacy.find_path">[docs]</a>    <span class="k">def</span> <span class="nf">find_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">src_pt</span><span class="p">,</span> <span class="n">dst_pt</span><span class="p">,</span> <span class="n">precision_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;find a path between two locations on a root_id using the supervoxel lvl2 graph.</span>

<span class="sd">        Args:</span>
<span class="sd">            root_id (np.int64): the root id to search on</span>
<span class="sd">            src_pt (np.array): len(3) xyz location of the start location in nm</span>
<span class="sd">            dst_pt ([type]): len(3) xyz location of the end location in nm</span>
<span class="sd">            precision_mode (bool, optional): Whether to perform the search in precision mode. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            centroids_list: centroids</span>
<span class="sd">            l2_path: l2_path</span>
<span class="sd">            failed_l2_ids: failed_l2_ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_url_mapping</span>
        <span class="n">endpoint_mapping</span><span class="p">[</span><span class="s2">&quot;root_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_id</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span><span class="p">[</span><span class="s2">&quot;find_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">endpoint_mapping</span><span class="p">)</span>
        <span class="n">query_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">query_d</span><span class="p">[</span><span class="s2">&quot;precision_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_mode</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[[</span><span class="n">root_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">src_pt</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="n">root_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">dst_pt</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CGEncoder</span><span class="p">),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">query_d</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">resp_d</span> <span class="o">=</span> <span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resp_d</span><span class="p">[</span><span class="s2">&quot;centroids_list&quot;</span><span class="p">])</span>
        <span class="n">failed_l2_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resp_d</span><span class="p">[</span><span class="s2">&quot;failed_l2_ids&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
        <span class="n">l2_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resp_d</span><span class="p">[</span><span class="s2">&quot;l2_path&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">l2_path</span><span class="p">,</span> <span class="n">failed_l2_ids</span></div></div>


<span class="n">client_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="n">ChunkedGraphClientLegacy</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="n">ChunkedGraphClientV1</span><span class="p">,</span>
    <span class="s2">&quot;latest&quot;</span><span class="p">:</span> <span class="n">ChunkedGraphClientV1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Casey Schneider-Mizell, Forrest Collman, Sven Dorkenwald.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>